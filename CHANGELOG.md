# Changelog

## [æœªãƒªãƒªãƒ¼ã‚¹] - 2025-06-19

### ğŸ”§ ä¿®æ­£ (Fixed)
- **ãƒ©ãƒ³ã‚­ãƒ³ã‚°API**: `TypeError: Cannot read properties of undefined (reading 'toString')` ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
- **ãƒ¢ãƒƒã‚¯ç’°å¢ƒ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®_idä¿è¨¼ã‚’å¼·åŒ–ã—ã€undefinedå€¤ã«ã‚ˆã‚‹500ã‚¨ãƒ©ãƒ¼ã‚’é˜²æ­¢
- **populateå¤±æ•—æ™‚**: å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…

### âœ¨ è¿½åŠ  (Added)
- **ãƒ†ã‚¹ãƒˆ**: ãƒ©ãƒ³ã‚­ãƒ³ã‚°APIã®åŒ…æ‹¬çš„ãªå˜ä½“ãƒ†ã‚¹ãƒˆè¿½åŠ  (`server/tests/ranking.test.js`)
- **å‹å®šç¾©**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹å®šç¾©ã‚’æ›´æ–°ã—ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¨ãƒ³ãƒˆãƒªã«grade/avatarãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- **ãƒ­ã‚°æ©Ÿèƒ½**: console.logã‚’logger.debugã«ç½®ãæ›ãˆã¦ä¸€è²«æ€§ã‚’å‘ä¸Š

### ğŸ—ï¸ å¤‰æ›´ (Changed)
- **ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼**: undefined safetyå¯¾å¿œã®å…¨é¢ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- **ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿**: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ æ™‚ã®_idé‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½è¿½åŠ 
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚ˆã‚Šè©³ç´°ã§å®‰å…¨ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’å®Ÿè£…

### ğŸ“ æŠ€è¡“çš„è©³ç´°

#### server/controllers/rankingController.js
- `allUserIds`ç”Ÿæˆæ™‚ã®null/undefinedå®‰å…¨æ€§ã‚’ç¢ºä¿
- populateå¤±æ•—æ™‚ã®ä»£æ›¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒãŸãªã„gradeãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«`?? 0`ã‚’è¿½åŠ 

#### server/config/database.js
- `addMockUser()`ã§_idé‡è¤‡ãƒã‚§ãƒƒã‚¯ã¨å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
- `getMockUsers()`ã§ç„¡åŠ¹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é™¤å¤–æ©Ÿèƒ½è¿½åŠ 

#### server/tests/ranking.test.js
- populateæˆåŠŸ/å¤±æ•—ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 
- ãƒ¢ãƒƒã‚¯ç’°å¢ƒã§ã®500ã‚¨ãƒ©ãƒ¼é˜²æ­¢ãƒ†ã‚¹ãƒˆ
- å›å¸°ãƒ†ã‚¹ãƒˆ (TypeErroré˜²æ­¢)

#### src/types/api.ts
- `RankingEntry`ã«grade, avatar, streakç­‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- `RankingApiResponse`ã®æ§‹é€ ã‚’ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«åˆã‚ã›ã¦ä¿®æ­£

### ğŸ¯ DoDå®Œäº†é …ç›®
- âœ… 500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã›ãšã€æ­£å¸¸æ™‚`status 200 + JSON { success:true, data:[...] }`ã‚’è¿”ã™
- âœ… populateæˆåŠŸ/å¤±æ•—ã©ã¡ã‚‰ã§ã‚‚`userId`, `username`, `grade`, `avatar`ãŒå¿…ãšåŸ‹ã¾ã‚‹
- âœ… ãƒ¢ãƒƒã‚¯ç’°å¢ƒ(`MONGODB_MOCK=true`)ã¨å®ŸDBç’°å¢ƒã®ä¸¡æ–¹ã§å‹•ä½œ
- âœ… TypeScriptå‹å®šç¾©ã‚’ç¶­æŒ
- âœ… ã‚³ãƒ¼ãƒ‰æ•´å½¢ã¨ãƒ­ã‚°ã®ä¸€è²«æ€§å‘ä¸Š

### ğŸ§ª æ¤œè¨¼æ–¹æ³•
```bash
# ãƒ¢ãƒƒã‚¯ç’°å¢ƒãƒ†ã‚¹ãƒˆ
MONGODB_MOCK=true npm run dev
curl "http://localhost:5003/api/rankings/daily?difficulty=beginner&date=2025-06-19"

# å®ŸDBç’°å¢ƒãƒ†ã‚¹ãƒˆ  
MONGODB_MOCK=false npm run dev
curl "http://localhost:5003/api/rankings/daily?difficulty=beginner"

# å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cd server && npm test
```